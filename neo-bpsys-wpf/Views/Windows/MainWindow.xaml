<ui:FluentWindow
    x:Class="neo_bpsys_wpf.Views.Windows.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:ab="clr-namespace:neo_bpsys_wpf.AttachedBehaviors"
    xmlns:controls="clr-namespace:neo_bpsys_wpf.Controls"
    xmlns:cv="clr-namespace:neo_bpsys_wpf.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:lex="http://wpflocalizeextension.codeplex.com"
    xmlns:local="clr-namespace:neo_bpsys_wpf"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:neo_bpsys_wpf.ViewModels.Windows"
    Title="{lex:Loc Backend}"
    Width="980"
    Height="760"
    d:DataContext="{d:DesignInstance Type=vm:MainWindowViewModel,
                                     IsDesignTimeCreatable=True}"
    lex:LocalizeDictionary.DesignCulture="zh-Hans"
    lex:ResxLocalizationProvider.DefaultAssembly="neo-bpsys-wpf"
    lex:ResxLocalizationProvider.DefaultDictionary="Locales.Lang"
    ui:Design.Background="{DynamicResource ApplicationBackgroundBrush}"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    RenderOptions.BitmapScalingMode="HighQuality"
    RenderOptions.ClearTypeHint="Enabled"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <ui:FluentWindow.Resources>
        <ResourceDictionary>
            <cv:ApplicationThemeToBooleanConverter x:Key="ApplicationThemeToBooleanConverter" />
            <!--  Theme Change Animation  -->
            <Storyboard x:Key="LightToDark">
                <DoubleAnimation
                    Storyboard.TargetName="themeMask"
                    Storyboard.TargetProperty="(UIElement.Opacity)"
                    From="1"
                    To="0"
                    Duration="00:00:0.6" />
                <ColorAnimation
                    Storyboard.TargetName="themeMask"
                    Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                    From="White"
                    To="#202020"
                    Duration="00:00:0.6" />
            </Storyboard>
            <Storyboard x:Key="DarkToLight">
                <DoubleAnimation
                    Storyboard.TargetName="themeMask"
                    Storyboard.TargetProperty="(UIElement.Opacity)"
                    From="1"
                    To="0"
                    Duration="600" />
                <ColorAnimation
                    Storyboard.TargetName="themeMask"
                    Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                    From="#202020"
                    To="White"
                    Duration="00:00:0.6" />
            </Storyboard>
            <Storyboard x:Key="StartupLoading">
                <ObjectAnimationUsingKeyFrames Storyboard.TargetName="loading" Storyboard.TargetProperty="(UIElement.Visibility)">
                    <DiscreteObjectKeyFrame KeyTime="00:00:05" Value="{x:Static Visibility.Collapsed}" />
                </ObjectAnimationUsingKeyFrames>
                <DoubleAnimation
                    BeginTime="00:00:04.75"
                    Storyboard.TargetName="loading"
                    Storyboard.TargetProperty="(UIElement.Opacity)"
                    From="1"
                    To="0"
                    Duration="00:00:0.5" />
                <DoubleAnimation
                    BeginTime="00:00:0"
                    Storyboard.TargetName="loadingProgress"
                    Storyboard.TargetProperty="Value"
                    From="0"
                    To="25"
                    Duration="0:0:0.3" />
                <DoubleAnimation
                    BeginTime="00:00:4.45"
                    Storyboard.TargetName="loadingProgress"
                    Storyboard.TargetProperty="Value"
                    From="25"
                    To="100"
                    Duration="0:0:0.3" />
            </Storyboard>
        </ResourceDictionary>
    </ui:FluentWindow.Resources>
    <i:Interaction.Triggers>
        <i:DataTrigger Binding="{Binding ApplicationTheme, Converter={StaticResource ApplicationThemeToBooleanConverter}, Mode=TwoWay}" Value="True">
            <i:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource LightToDark}" />
        </i:DataTrigger>
        <i:DataTrigger Binding="{Binding ApplicationTheme, Converter={StaticResource ApplicationThemeToBooleanConverter}, Mode=TwoWay}" Value="False">
            <i:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource DarkToLight}" />
        </i:DataTrigger>
    </i:Interaction.Triggers>
    <WindowChrome.WindowChrome>
        <WindowChrome
            CaptionHeight="35"
            CornerRadius="8"
            GlassFrameThickness="0"
            ResizeBorderThickness="5"
            UseAeroCaptionButtons="False" />
    </WindowChrome.WindowChrome>
    <Grid>
        <i:Interaction.Triggers>
            <i:EventTrigger EventName="Loaded">
                <i:ControlStoryboardAction ControlStoryboardOption="Play" Storyboard="{StaticResource StartupLoading}" />
            </i:EventTrigger>
        </i:Interaction.Triggers>
        <!--  Snackbar  -->
        <ui:SnackbarPresenter
            x:Name="SnbPre"
            HorizontalAlignment="Right"
            VerticalAlignment="Bottom"
            Panel.ZIndex="2" />
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto " />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <!--  TitleBar  -->
            <controls:CustomTitleBar
                Grid.Row="0"
                Icon="/Assets/icon.png"
                IsThemeChangeChecked="{Binding ApplicationTheme, Converter={StaticResource ApplicationThemeToBooleanConverter}, Mode=TwoWay}"
                ThemeChangeCommand="{Binding ThemeSwitchCommand}" />
            <!--  Body  -->

            <!--  Global menu  -->
            <WrapPanel
                Grid.Row="1"
                Margin="10,10,0,0"
                Orientation="Horizontal">
                <!--  current team  -->
                <Border Width="360" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="Auto" />
                        </Grid.RowDefinitions>
                        <StackPanel Grid.Row="0" Orientation="Horizontal">
                            <TextBlock Text="{lex:Loc CurrentSurvivorTeamColon}" />
                            <TextBlock Margin="20,0,0,0" Text="{Binding CurrentGame.SurTeam.Name}" />
                        </StackPanel>
                        <ui:Button
                            Grid.Row="1"
                            Margin="0,10,0,10"
                            HorizontalAlignment="Center"
                            Command="{Binding SwapCommand}"
                            Content="{lex:Loc Swap}"
                            Icon="{ui:SymbolIcon Symbol=ArrowSort24}">
                            <i:Interaction.Triggers>
                                <i:DataTrigger Binding="{Binding IsSwapHighlighted}" Value="true">
                                    <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource HighlightedButton}" />
                                </i:DataTrigger>
                                <i:DataTrigger Binding="{Binding IsSwapHighlighted}" Value="false">
                                    <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource {x:Type ui:Button}}" />
                                </i:DataTrigger>
                            </i:Interaction.Triggers>
                        </ui:Button>
                        <StackPanel Grid.Row="2" Orientation="Horizontal">
                            <TextBlock Text="{lex:Loc CurrentHunterTeamColon}" />
                            <TextBlock Margin="20,0,0,0" Text="{Binding CurrentGame.HunTeam.Name}" />
                        </StackPanel>
                    </Grid>
                </Border>
                <!--  timer  -->
                <Border Width="390" Style="{StaticResource Card}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="{lex:Loc CountDown}" />
                        <StackPanel
                            Grid.Row="1"
                            Margin="0,10,0,0"
                            VerticalAlignment="Center"
                            Orientation="Horizontal">
                            <ComboBox
                                Width="100"
                                d:Text="30"
                                IsEditable="True"
                                IsTextSearchEnabled="False"
                                ItemsSource="{Binding RecommendTimerList}"
                                MaxDropDownHeight="150"
                                SelectedIndex="0"
                                Text="{Binding TimerTime}" />
                            <ui:Button
                                Margin="10,0,0,0"
                                Command="{Binding TimerStartCommand}"
                                Content="{lex:Loc Start}"
                                Icon="{ui:SymbolIcon Symbol=Play24}" />
                            <ui:Button
                                Margin="10,0,0,0"
                                Command="{Binding TimerStopCommand}"
                                Content="{lex:Loc Stop}"
                                Icon="{ui:SymbolIcon Symbol=Stop24}" />
                            <TextBlock
                                Width="60"
                                Margin="10,0,0,0"
                                VerticalAlignment="Center"
                                Text="{lex:Loc PreviewColon}" />
                            <TextBlock
                                Width="25"
                                Margin="10,0,0,0"
                                VerticalAlignment="Center"
                                d:Text="VS"
                                Text="{Binding RemainingSeconds}" />
                        </StackPanel>
                    </Grid>
                </Border>
                <!--  game control  -->
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding SaveGameInfoCommand}"
                    Content="{lex:Loc SaveGameInformation}"
                    Icon="{ui:SymbolIcon Symbol=Save24}" />
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding NewGameCommand}"
                    Content="{lex:Loc NewGame}"
                    Icon="{ui:SymbolIcon Symbol=Add24}" />
                <Border Margin="0,0,10,10" Style="{StaticResource Card}">
                    <StackPanel Orientation="Horizontal">
                        <TextBlock
                            Grid.Row="0"
                            VerticalAlignment="Center"
                            Text="{lex:Loc FormatColon}" />
                        <RadioButton
                            Margin="10,0,0,0"
                            Content="BO5"
                            GroupName="Bo3Mode"
                            IsChecked="True"
                            IsEnabled="{Binding CanGameProgressChange}" />
                        <RadioButton
                            Content="BO3"
                            GroupName="Bo3Mode"
                            IsChecked="{Binding IsBo3Mode}"
                            IsEnabled="{Binding CanGameProgressChange}" />
                    </StackPanel>
                </Border>
                <TextBlock
                    Margin="0,0,10,10"
                    VerticalAlignment="Center"
                    Text="{lex:Loc GameProgressColon}" />
                <ComboBox
                    Width="215"
                    Margin="0,0,10,10"
                    IsEnabled="{Binding CanGameProgressChange}"
                    ItemsSource="{Binding GameList}"
                    MaxDropDownHeight="190"
                    SelectedIndex="0"
                    SelectedValue="{Binding SelectedGameProgress}"
                    SelectedValuePath="Key">
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <TextBlock Text="{lex:Loc {Binding Path=Value}}" />
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                </ComboBox>
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding StartNavigationCommand}"
                    Content="{lex:Loc StartGameGuidance}"
                    Visibility="{Binding IsGuidanceStarted, Converter={StaticResource BooleanToReverseVisibilityConverter}}" />
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding NavigateToPreviousStepCommand}"
                    Content="{lex:Loc LastStep}"
                    Visibility="{Binding IsGuidanceStarted, Converter={StaticResource BoolToVisibilityConverter}}" />
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding NavigateToNextStepCommand}"
                    Content="{lex:Loc NextStep}"
                    Visibility="{Binding IsGuidanceStarted, Converter={StaticResource BoolToVisibilityConverter}}" />
                <ui:Button
                    Margin="0,0,10,10"
                    Command="{Binding StopNavigationCommand}"
                    Content="{lex:Loc EndGameGuidance}"
                    Visibility="{Binding IsGuidanceStarted, Converter={StaticResource BoolToVisibilityConverter}}">
                    <i:Interaction.Triggers>
                        <i:DataTrigger Binding="{Binding IsEndGuidanceHighlighted}" Value="true">
                            <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource HighlightedButton}" />
                        </i:DataTrigger>
                        <i:DataTrigger Binding="{Binding IsEndGuidanceHighlighted}" Value="false">
                            <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource {x:Type Button}}" />
                        </i:DataTrigger>
                    </i:Interaction.Triggers>
                </ui:Button>
                <TextBlock
                    Margin="0,0,10,10"
                    VerticalAlignment="Center"
                    Text="{Binding ActionName}"
                    Visibility="{Binding IsGuidanceStarted, Converter={StaticResource BoolToVisibilityConverter}}" />
            </WrapPanel>

            <!--  navigation  -->
            <Grid Grid.Row="2">
                <ui:InfoBar
                    Name="InfoBar"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    Panel.ZIndex="1" />
                <ui:NavigationView
                    x:Name="RootNavigation"
                    FooterMenuItemsSource="{Binding FooterMenuItems}"
                    IsBackButtonVisible="Collapsed"
                    IsPaneOpen="True"
                    IsPaneToggleVisible="True"
                    MenuItemsSource="{Binding MenuItems}"
                    OpenPaneLength="200">
                    <ui:NavigationView.ItemTemplate>
                        <ControlTemplate TargetType="{x:Type ui:NavigationViewItem}">
                            <Border
                                x:Name="MainBorder"
                                Height="40"
                                HorizontalAlignment="Stretch"
                                Background="Transparent"
                                BorderThickness="{DynamicResource NavigationViewItemThickness}"
                                CornerRadius="4">
                                <Grid Margin="0,0,0,0" HorizontalAlignment="Stretch">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="*" MinWidth="180" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <Rectangle
                                        x:Name="ActiveRectangle"
                                        Grid.Column="0"
                                        Width="3"
                                        Height="16"
                                        Margin="0"
                                        HorizontalAlignment="Left"
                                        VerticalAlignment="Center"
                                        Fill="{DynamicResource NavigationViewSelectionIndicatorForeground}"
                                        Opacity="0.0"
                                        RadiusX="2"
                                        RadiusY="2" />

                                    <ContentPresenter
                                        x:Name="IconContentPresenter"
                                        Grid.Column="1"
                                        Margin="6,0,3,0"
                                        HorizontalAlignment="Center"
                                        VerticalAlignment="Center"
                                        Content="{TemplateBinding Icon}"
                                        Focusable="False"
                                        TextElement.FontSize="18"
                                        TextElement.Foreground="{DynamicResource NavigationViewItemForeground}"
                                        Visibility="{TemplateBinding Icon,
                                                                     Converter={StaticResource NullToVisibilityConverter}}" />
                                    <ContentPresenter
                                        x:Name="ElementContentPresenter"
                                        Grid.Column="2"
                                        Margin="10,0,0,0"
                                        HorizontalAlignment="Stretch"
                                        VerticalAlignment="Center"
                                        Content="{lex:Loc {Binding Path=Content, RelativeSource={RelativeSource TemplatedParent}}}"
                                        ContentTemplate="{TemplateBinding ContentTemplate}"
                                        TextElement.FontSize="14"
                                        TextElement.Foreground="{TemplateBinding Foreground}" />
                                    <ContentPresenter Grid.Column="3" Content="{TemplateBinding InfoBadge}" />
                                </Grid>
                            </Border>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsActive" Value="True">
                                    <Setter TargetName="ActiveRectangle" Property="Opacity" Value="1.0" />
                                    <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource NavigationViewItemBackgroundSelected}" />
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource NavigationViewItemBackgroundPointerOver}" />
                                </Trigger>
                                <Trigger Property="IsPressed" Value="True">
                                    <Setter TargetName="MainBorder" Property="Background" Value="{DynamicResource NavigationViewItemBackgroundPressed}" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ui:NavigationView.ItemTemplate>
                </ui:NavigationView>
            </Grid>
        </Grid>
        <!--  主题切换相关的东西  -->
        <Border
            x:Name="themeMask"
            Panel.ZIndex="-1"
            Background="White"
            Opacity="0" />

        <!--  Loading  -->
        <Grid
            Name="loading"
            Panel.ZIndex="1"
            d:Visibility="Collapsed"
            Background="#202020">
            <Grid.RenderTransform>
                <ScaleTransform CenterX="415" CenterY="374.5" />
            </Grid.RenderTransform>
            <StackPanel
                HorizontalAlignment="Center"
                VerticalAlignment="Center"
                Panel.ZIndex="2">
                <Image
                    Width="75"
                    Height="75"
                    HorizontalAlignment="Center"
                    Source="/Assets/icon.png" />
                <TextBlock
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    FontFamily="{StaticResource SourceHan}"
                    FontSize="35"
                    Text="neo-bpsys-wpf" />
                <TextBlock
                    Margin="0,10,0,0"
                    HorizontalAlignment="Center"
                    FontFamily="{StaticResource SourceHan}"
                    FontSize="16"
                    Text="{lex:Loc AModernIdentityVBPSoftware}" />
                <ProgressBar
                    Name="loadingProgress"
                    Width="500"
                    Height="18"
                    Margin="0,20,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                    Value="20" />
            </StackPanel>
            <TextBlock
                Margin="0,0,0,10"
                HorizontalAlignment="Center"
                VerticalAlignment="Bottom"
                FontFamily="{StaticResource SourceHan}"
                FontSize="14"
                Text="{lex:Loc MadeByZeroPLFJY}" />
        </Grid>
    </Grid>
</ui:FluentWindow>
