<Page
    x:Class="neo_bpsys_wpf.Views.Pages.MapBpPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:neo_bpsys_wpf.Controls"
    xmlns:cv="clr-namespace:neo_bpsys_wpf.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:enum="clr-namespace:neo_bpsys_wpf.Enums"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:local="clr-namespace:neo_bpsys_wpf.Views.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:vm="clr-namespace:neo_bpsys_wpf.ViewModels.Pages"
    Title="MapBpPage"
    d:DataContext="{d:DesignInstance Type=vm:MapBpPageViewModel,
                                     IsDesignTimeCreatable=True}"
    d:DesignHeight="1500"
    d:DesignWidth="685"
    ui:Design.Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
    mc:Ignorable="d">
    <Page.Resources>
        <cv:BooleanToEnumConverter x:Key="BooleanToEnumConverter" />
    </Page.Resources>
    <StackPanel>
        <Border Style="{StaticResource Card}">
            <StackPanel Orientation="Horizontal">
                <ui:ToggleSwitch Content="待选框呼吸灯开关" IsChecked="{Binding IsBreathing}" />
                <ui:ToggleSwitch
                    Margin="10,0,0,0"
                    Content="阵营选择结果展示开关"
                    IsChecked="{Binding IsCampVisible}" />
                <ui:Button
                    Margin="10,0,0,0"
                    Command="{Binding ResetMapBpCommand}"
                    Content="重置地图BP"
                    Icon="{ui:SymbolIcon Symbol=ArrowReset24}" />
            </StackPanel>
        </Border>
        <Border Style="{StaticResource Card}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <TextBlock VerticalAlignment="Center" Text="地图选择" />
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" Text="操作队伍：" />
                        <ComboBox
                            ItemsSource="{Binding MapSelectTeamsList}"
                            SelectedIndex="0"
                            SelectedValue="{Binding PickMapTeam}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock>
                                            <Run Text="{Binding DisplayedTeamType, Mode=OneTime}" /><Run Text=" - " />
                                        </TextBlock>
                                        <TextBlock Text="{Binding Team.Name}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="SelectionChanged">
                                    <i:InvokeCommandAction Command="{Binding PickMapCommand}" CommandParameter="{Binding ElementName=PickMapCombobox, Path=SelectedValue}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </ComboBox>
                    </StackPanel>
                </Grid>
                <ComboBox
                    x:Name="PickMapCombobox"
                    Grid.Row="1"
                    Width="400"
                    Margin="0,10,0,0"
                    HorizontalAlignment="Left"
                    ItemsSource="{Binding PickedMapSelections}"
                    SelectedValue="{Binding PickedMap}"
                    SelectedValuePath="Map">
                    <ComboBox.ItemContainerStyle>
                        <Style BasedOn="{StaticResource {x:Type ComboBoxItem}}" TargetType="ComboBoxItem">
                            <Setter Property="IsEnabled" Value="{Binding CanPickInvoke}" />
                        </Style>
                    </ComboBox.ItemContainerStyle>
                    <ComboBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <ui:Image
                                    Width="200"
                                    CornerRadius="4"
                                    Source="{Binding ImageSource}" />
                                <TextBlock
                                    Margin="20,0,0,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    Text="{Binding Map}" />
                            </StackPanel>
                        </DataTemplate>
                    </ComboBox.ItemTemplate>
                    <i:Interaction.Triggers>
                        <i:EventTrigger EventName="SelectionChanged">
                            <i:InvokeCommandAction Command="{Binding PickMapCommand}" CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ComboBox}, Path=SelectedValue}" />
                        </i:EventTrigger>
                        <i:DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Page}, Path=DataContext.IsPickHighlighted}" Value="true">
                            <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource HighlightedComboBox}" />
                        </i:DataTrigger>
                        <i:DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Page}, Path=DataContext.IsPickHighlighted}" Value="false">
                            <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource {x:Type ComboBox}}" />
                        </i:DataTrigger>
                    </i:Interaction.Triggers>
                </ComboBox>
            </Grid>
        </Border>
        <Border Style="{StaticResource Card}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>
                <Grid Grid.Row="0">
                    <TextBlock VerticalAlignment="Center" Text="地图禁用" />
                    <StackPanel HorizontalAlignment="Right" Orientation="Horizontal">
                        <TextBlock VerticalAlignment="Center" Text="操作队伍：" />
                        <ComboBox
                            ItemsSource="{Binding MapSelectTeamsList}"
                            SelectedIndex="0"
                            SelectedValue="{Binding BanMapTeam}">
                            <ComboBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock>
                                            <Run Text="{Binding DisplayedTeamType, Mode=OneTime}" /><Run Text=" - " />
                                        </TextBlock>
                                        <TextBlock Text="{Binding Team.Name}" />
                                    </StackPanel>
                                </DataTemplate>
                            </ComboBox.ItemTemplate>
                            <i:Interaction.Triggers>
                                <i:EventTrigger EventName="SelectionChanged">
                                    <i:InvokeCommandAction Command="{Binding BanMapCommand}" />
                                </i:EventTrigger>
                            </i:Interaction.Triggers>
                        </ComboBox>
                    </StackPanel>
                </Grid>
                <ItemsControl
                    Grid.Row="1"
                    Margin="0,10,0,0"
                    ItemsSource="{Binding BannedMap}">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <WrapPanel Orientation="Horizontal" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <ToggleButton
                                Margin="0,0,10,10"
                                Command="{Binding DataContext.BanMapCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                CommandParameter="{Binding Map}"
                                IsChecked="{Binding IsBanned, Mode=TwoWay}"
                                IsEnabled="{Binding CanBanInvoke}">
                                <StackPanel IsEnabled="{TemplateBinding IsEnabled}">
                                    <Image
                                        Width="276"
                                        Height="73"
                                        Margin="0,0,0,5"
                                        Focusable="False"
                                        Source="{Binding ImageSource}"
                                        Stretch="UniformToFill" />
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        Focusable="False"
                                        FontSize="14"
                                        Text="{Binding Map}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsEnabled, RelativeSource={RelativeSource AncestorType=ToggleButton}}" Value="false">
                                                        <Setter Property="Foreground" Value="Gray" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                            </ToggleButton>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
                <i:Interaction.Triggers>
                    <i:DataTrigger Binding="{Binding IsBanHighlighted}" Value="true">
                        <i:ChangePropertyAction PropertyName="Style" Value="{StaticResource HighlightedGrid}" />
                    </i:DataTrigger>
                    <i:DataTrigger Binding="{Binding IsBanHighlighted}" Value="false">
                        <i:ChangePropertyAction PropertyName="Style" Value="{x:Null}" />
                    </i:DataTrigger>
                </i:Interaction.Triggers>
            </Grid>
        </Border>
    </StackPanel>
</Page>
